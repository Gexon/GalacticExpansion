# Симуляция геймплея (GLEX)

**Назначение**: описать, как “экспансия Zirax” моделируется в виде правил/состояния.  
**Аудитория**: разработчики.  
**Статус**: draft.  
**Связанные документы**: [`02_stages_and_prefabs.md`](02_stages_and_prefabs.md), [`03_threat_director.md`](03_threat_director.md), [`../config/state_schema.md`](../config/state_schema.md).  

## Основная идея

GLEX не пытается “воссоздать полноценный AI”, а строит симуляцию на правилах:

- есть `Colony` в `state.json`;
- колония имеет `Stage` (стадию);
- стадия определяет, какие префабы/угрозы/аутпосты должны существовать;
- со временем и при накоплении виртуальных ресурсов колония развивается;
- при вмешательстве игроков (разрушения) — колония откатывается/перестраивается и усиливает давление.

## Виртуальные ресурсы

В MVP ресурсы не обязаны отражать реальные депозиты:

- `virtualResources += productionRate * dt`

Дальше StageManager решает, хватает ли ресурсов/времени для апгрейда.

## Реакция на разрушение

Уничтожение ключевой сущности стадии → событие в state:

- `rebuildPending = true`
- `stage = <previous stage>` или `stage = RebuildPending`

и далее симуляция планирует реконструкцию.
