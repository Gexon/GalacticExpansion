# Модель данных (GLEX)

**Назначение**: описать данные симуляции (state), версии схемы и миграции.  
**Аудитория**: разработчики.  
**Статус**: draft.  
**Связанные документы**: [`../config/state_schema.md`](../config/state_schema.md), [`03_Технический_проект.md`](03_Технический_проект.md).  

## Базовый принцип

GLEX должен переживать:

- перезапуски сервера,
- обновления мода,
- частичные сбои (например, не удалось заспавнить сущность в этот тик).

Для этого состояние симуляции хранится в `state.json`.

## Версионирование схемы

`state.json` должен содержать поле `schemaVersion` (целое число) и при загрузке выполняться миграции:

- v1 → v2 → ... последовательно,
- каждый шаг миграции логируется,
- миграции должны быть идемпотентными (повторный прогон не ломает данные).

## Атомарная запись

Запись состояния должна быть атомарной:

- записать во временный файл `state.json.tmp`,
- затем заменить `state.json`.

> Это защищает от “обрыва питания/краша” посередине записи.

## Сущности симуляции (концептуально)

- `WorldState`
  - `HomePlayfield`
  - `Colonies[]`
  - метаданные/таймстемпы

- `Colony`
  - `Playfield`
  - `Stage`
  - ссылки на заспавненные entityId (база/аутпосты/корабли)
  - “виртуальные ресурсы”
  - очереди планов (build/upgrade/rebuild)
