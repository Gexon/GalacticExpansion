# –ú–æ–¥—É–ª—å: Transport Manager

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** 3 (–°—Ä–µ–¥–Ω–∏–π - —É–ª—É—á—à–µ–Ω–∏–µ –∏–º–º–µ—Ä—Å–∏–≤–Ω–æ—Å—Ç–∏)  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Module_04 (Entity Spawner), Module_05 (AIM Orchestrator), Module_13 (Unit Economy)  
**–°—Ç–∞—Ç—É—Å:** üî¥ –ù–µ –Ω–∞—á–∞—Ç

---

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

Transport Manager —É–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π —é–Ω–∏—Ç–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–ª–∞–Ω–µ—Ç—ã** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∏–º–º–µ—Ä—Å–∏–≤–Ω–æ—Å—Ç–∏. –í–º–µ—Å—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Å–ø–∞–≤–Ω–∞ —é–Ω–∏—Ç—ã –ø—Ä–∏–±—ã–≤–∞—é—Ç –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ, —Å–æ–∑–¥–∞–≤–∞—è –æ—â—É—â–µ–Ω–∏–µ –∂–∏–≤–æ–π –≤–æ–µ–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

**–õ–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
- ‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–ª–∞–Ω–µ—Ç—ã (playfield)
- ‚úÖ –ú–µ–∂—Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–ª–µ—Ç—ã –ù–ï —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è (—Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–æ–Ω–∏–∏ (–±–∞–∑–∞, –ø–æ—Ä—Ç–∞–ª)

---

## 2. –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 2.1 –ê—Ç–∞–∫–∞ –Ω–∞ –∞–≤–∞–Ω–ø–æ—Å—Ç ‚Üí –¥–µ—Å–∞–Ω—Ç —Å –±–∞–∑—ã

```
[–ê–≤–∞–Ω–ø–æ—Å—Ç –∞—Ç–∞–∫–æ–≤–∞–Ω] ‚Üí [–ë–∞–∑–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç DropShip] ‚Üí [DropShip –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ö—Ä–∞–Ω–Ω–∏–∫–æ–≤]
```

**–õ–æ–≥–∏–∫–∞:**
- –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫—É–µ—Ç —Ä–µ—Å—É—Ä—Å–Ω—ã–π –∞–≤–∞–Ω–ø–æ—Å—Ç
- –ì–ª–∞–≤–Ω–∞—è –±–∞–∑–∞ –∫–æ–ª–æ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Å–∞–Ω—Ç–Ω—ã–π –∫–æ—Ä–∞–±–ª—å
- DropShip –ª–µ—Ç–∏—Ç –æ—Ç –±–∞–∑—ã –∫ –∞–≤–∞–Ω–ø–æ—Å—Ç—É (1-2 –º–∏–Ω—É—Ç—ã)
- –û—Ö—Ä–∞–Ω–Ω–∏–∫–∏ –≤—ã—Å–∞–∂–∏–≤–∞—é—Ç—Å—è —Ä—è–¥–æ–º —Å –∞–≤–∞–Ω–ø–æ—Å—Ç–æ–º

### 2.2 –ê—Ç–∞–∫–∞ –Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –±–∞–∑—É ‚Üí —Å–ø–∞–≤–Ω –∏–∑ –±–∞–∑—ã/–ø–æ—Ä—Ç–∞–ª–∞

```
[–ë–∞–∑–∞ –∞—Ç–∞–∫–æ–≤–∞–Ω–∞] ‚Üí [–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –±–∞–∑] ‚Üí [–ó–∞—â–∏—Ç–Ω–∏–∫–∏ –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –±–∞–∑—ã –ò–õ–ò –ø–æ—Ä—Ç–∞–ª–∞]
```

**–õ–æ–≥–∏–∫–∞:**
- –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫—É–µ—Ç –≥–ª–∞–≤–Ω—É—é –±–∞–∑—É –∫–æ–ª–æ–Ω–∏–∏
- –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Ä—Ç–∞–ª ‚Üí –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∏ —Å–ø–∞–≤–Ω—è—Ç—Å—è —É –ø–æ—Ä—Ç–∞–ª–∞ (—Ç–µ–ª–µ–ø–æ—Ä—Ç –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏—è)
- –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ—Ä—Ç–∞–ª–∞ ‚Üí –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∏ —Å–ø–∞–≤–Ω—è—Ç—Å—è —É –≤—ã—Ö–æ–¥–∞ –∏–∑ –±–∞–∑—ã (–≥–∞—Ä–Ω–∏–∑–æ–Ω)
- **–ù–ï–¢ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** (–Ω–µ–∫—É–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å, –±–∞–∑–∞ —Å–∞–º–∞ –ø–æ–¥ –∞—Ç–∞–∫–æ–π)

### 2.3 –ü–∞—Ç—Ä—É–ª–∏ ‚Üí –∑–∞–ø—É—Å–∫ –∏–∑ –∞–Ω–≥–∞—Ä–∞ –±–∞–∑—ã

```
[–ü–ª–∞–Ω–æ–≤–æ–µ –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ] ‚Üí [SV –≤—ã–ª–µ—Ç–∞–µ—Ç –∏–∑ –∞–Ω–≥–∞—Ä–∞] ‚Üí [–ü–∞—Ç—Ä—É–ª—å –ø–æ –º–∞—Ä—à—Ä—É—Ç—É]
```

**–õ–æ–≥–∏–∫–∞:**
- –ë–∞–∑–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ç—Ä—É–ª—å–Ω—ã–µ –∫–æ—Ä–∞–±–ª–∏
- SV —Å–ø–∞–≤–Ω–∏—Ç—Å—è —Ä—è–¥–æ–º —Å –±–∞–∑–æ–π (–∏–º–∏—Ç–∞—Ü–∏—è –∞–Ω–≥–∞—Ä–∞)
- SV –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–∞—Ç—Ä—É–ª—å

### 2.4 –õ–æ–≥–∏—Å—Ç–∏–∫–∞ ‚Üí —Å–Ω–∞–±–∂–µ–Ω–∏–µ –∞–≤–∞–Ω–ø–æ—Å—Ç–æ–≤

```
[–†–µ–≥—É–ª—è—Ä–Ω—ã–π —Ä–µ–π—Å] ‚Üí [HV/SV –µ–¥–µ—Ç –∫ –∞–≤–∞–Ω–ø–æ—Å—Ç—É] ‚Üí [–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ]
```

**–õ–æ–≥–∏–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç):**
- –ë–∞–∑–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∫ –∞–≤–∞–Ω–ø–æ—Å—Ç—É
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–≤–∏–∂–µ—Ç—Å—è, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
- –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–µ–π–º–ø–ª–µ–π, —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª

---

## 3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```csharp
/// <summary>
/// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π —é–Ω–∏—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–Ω–µ—Ç—ã
/// </summary>
public interface ITransportManager
{
    // === –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ===
    
    /// <summary>
    /// –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –∫ –∞—Ç–∞–∫–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
    /// –ï—Å–ª–∏ destination == –≥–ª–∞–≤–Ω–∞—è –±–∞–∑–∞ ‚Üí —Å–ø–∞–≤–Ω –∏–∑ –±–∞–∑—ã/–ø–æ—Ä—Ç–∞–ª–∞.
    /// –ï—Å–ª–∏ destination != –≥–ª–∞–≤–Ω–∞—è –±–∞–∑–∞ ‚Üí —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ—Ç –±–∞–∑—ã.
    /// </summary>
    Task<TransportMission> DeployDefendersAsync(
        Colony colony,
        Vector3 destination,
        int defenderCount
    );
    
    /// <summary>
    /// –ó–∞–ø—É—Å–∫ –ø–∞—Ç—Ä—É–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è –∏–∑ –∞–Ω–≥–∞—Ä–∞ –±–∞–∑—ã
    /// </summary>
    Task<int> LaunchPatrolVesselAsync(
        Colony colony,
        List<Vector3> patrolRoute
    );
    
    /// <summary>
    /// –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)
    /// </summary>
    Task StartLogisticsRunAsync(
        Colony colony,
        Vector3 outpostPosition
    );
    
    // === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏—è–º–∏ ===
    
    /// <summary>
    /// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –º–∏—Å—Å–∏–π (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ Core Loop)
    /// </summary>
    void UpdateTransportMissions(float deltaTime);
    
    /// <summary>
    /// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∏—Å—Å–∏–π –∫–æ–ª–æ–Ω–∏–∏
    /// </summary>
    List<TransportMission> GetActiveMissions(string colonyId);
}

/// <summary>
/// –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –º–∏—Å—Å–∏—è
/// </summary>
public class TransportMission
{
    public string MissionId { get; set; }
    public string ColonyId { get; set; }
    public int TransportEntityId { get; set; }
    public TransportType TransportType { get; set; }
    
    public Vector3 StartPosition { get; set; }
    public Vector3 Destination { get; set; }
    public MissionPhase CurrentPhase { get; set; }
    
    public int CargoCount { get; set; }
    public List<int> DeployedUnitIds { get; set; } = new();
    
    public DateTime StartTime { get; set; }
    public DateTime? EstimatedArrival { get; set; }
    
    public bool IsDirectSpawn { get; set; }  // true = —Å–ø–∞–≤–Ω –±–µ–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (–±–∞–∑–∞/–ø–æ—Ä—Ç–∞–ª)
}

public enum TransportType
{
    None,           // –ü—Ä—è–º–æ–π —Å–ø–∞–≤–Ω (–±–µ–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
    DropShip,       // –î–µ—Å–∞–Ω—Ç–Ω—ã–π –∫–æ—Ä–∞–±–ª—å (SV)
    PatrolSV,       // –ü–∞—Ç—Ä—É–ª—å–Ω—ã–π –∫–æ—Ä–∞–±–ª—å
    LogisticsHV,    // –ù–∞–∑–µ–º–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    LogisticsSV     // –í–æ–∑–¥—É—à–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
}

public enum MissionPhase
{
    Preparing,      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (—Å–ø–∞–≤–Ω —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
    EnRoute,        // –í –ø—É—Ç–∏
    Deploying,      // –í—ã—Å–∞–¥–∫–∞
    Returning,      // –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ
    Completed       // –ó–∞–≤–µ—Ä—à–µ–Ω–∞
}
```

---

## 4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã)

### 4.1 –£–º–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤

```csharp
/// <summary>
/// –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –º–µ—Ç–æ–¥–∞:
/// - –ê—Ç–∞–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é –±–∞–∑—É ‚Üí —Å–ø–∞–≤–Ω –∏–∑ –±–∞–∑—ã/–ø–æ—Ä—Ç–∞–ª–∞
/// - –ê—Ç–∞–∫–∞ –Ω–∞ –∞–≤–∞–Ω–ø–æ—Å—Ç ‚Üí —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ—Ç –±–∞–∑—ã
/// </summary>
public async Task<TransportMission> DeployDefendersAsync(
    Colony colony,
    Vector3 destination,
    int defenderCount)
{
    // –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —é–Ω–∏—Ç–æ–≤
    if (!_unitEconomy.CanSpawnUnit(colony, UnitType.Guard, defenderCount))
    {
        var available = _unitEconomy.GetAvailableCount(colony, UnitType.Guard);
        defenderCount = Math.Min(defenderCount, available);
        if (defenderCount == 0) return null;
    }
    
    if (!_unitEconomy.ReserveUnits(colony, UnitType.Guard, defenderCount))
        return null;
    
    // –®–ê–ì 2: –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∑–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–π –±–∞–∑—ã –∏–ª–∏ –∞–≤–∞–Ω–ø–æ—Å—Ç–∞
    var distanceToBase = Vector3.Distance(destination, colony.Position);
    var isMainBaseDefense = distanceToBase < 200f;  // –ê—Ç–∞–∫–∞ –≤ —Ä–∞–¥–∏—É—Å–µ 200–º –æ—Ç –±–∞–∑—ã
    
    if (isMainBaseDefense)
    {
        // –°–¶–ï–ù–ê–†–ò–ô A: –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–π –±–∞–∑—ã ‚Üí —Å–ø–∞–≤–Ω –ª–æ–∫–∞–ª—å–Ω–æ
        return await DeployFromBaseOrPortalAsync(colony, destination, defenderCount);
    }
    else
    {
        // –°–¶–ï–ù–ê–†–ò–ô B: –ó–∞—â–∏—Ç–∞ –∞–≤–∞–Ω–ø–æ—Å—Ç–∞ ‚Üí —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ—Ç –±–∞–∑—ã
        return await DeployViaTransportAsync(colony, destination, defenderCount);
    }
}

/// <summary>
/// –°–¶–ï–ù–ê–†–ò–ô A: –°–ø–∞–≤–Ω –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –∏–ª–∏ –ø–æ—Ä—Ç–∞–ª–∞ (–±–µ–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
/// </summary>
private async Task<TransportMission> DeployFromBaseOrPortalAsync(
    Colony colony,
    Vector3 destination,
    int defenderCount)
{
    Vector3 spawnPosition;
    string spawnSource;
    
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø–æ—Ä—Ç–∞–ª ‚Üí –±–∞–∑–∞
    if (colony.HasPortal && colony.PortalPosition != null)
    {
        spawnPosition = colony.PortalPosition.Value;
        spawnSource = "Portal";
        _logger.LogInformation(
            $"Colony {colony.Id}: Deploying {defenderCount} defenders via Portal"
        );
    }
    else
    {
        // –°–ø–∞–≤–Ω —Ä—è–¥–æ–º —Å –±–∞–∑–æ–π (–∏–º–∏—Ç–∞—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–Ω–≥–∞—Ä–∞/–∫–∞–∑–∞—Ä–º—ã)
        spawnPosition = colony.Position + new Vector3(
            Random.Range(-20, 20),
            0,
            Random.Range(-20, 20)
        );
        spawnSource = "Base Garrison";
        _logger.LogInformation(
            $"Colony {colony.Id}: Deploying {defenderCount} defenders from Base Garrison"
        );
    }
    
    // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å–ø–∞–≤–Ω –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤
    var guardIds = await _spawner.SpawnNPCGroupAsync(
        "ZiraxMinigunPatrol",
        spawnPosition,
        defenderCount,
        colony.FactionId
    );
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —é–Ω–∏—Ç—ã
    foreach (var entityId in guardIds)
    {
        _unitEconomy.RegisterActiveUnit(colony, entityId, UnitType.Guard, spawnSource);
    }
    
    // –°–æ–∑–¥–∞–µ–º –º–∏—Å—Å–∏—é (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –±–µ–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
    var mission = new TransportMission
    {
        MissionId = Guid.NewGuid().ToString(),
        ColonyId = colony.Id,
        TransportType = TransportType.None,
        StartPosition = spawnPosition,
        Destination = destination,
        CurrentPhase = MissionPhase.Completed,
        CargoCount = defenderCount,
        DeployedUnitIds = guardIds,
        StartTime = DateTime.UtcNow,
        IsDirectSpawn = true
    };
    
    return mission;
}

/// <summary>
/// –°–¶–ï–ù–ê–†–ò–ô B: –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
/// </summary>
private async Task<TransportMission> DeployViaTransportAsync(
    Colony colony,
    Vector3 destination,
    int defenderCount)
{
    // –°–ø–∞–≤–Ω —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–∞–¥ –±–∞–∑–æ–π
    var spawnPosition = new Vector3(
        colony.Position.X + Random.Range(-30, 30),
        colony.Position.Y + 250f,  // –í—ã—Å–æ–∫–æ –≤ –Ω–µ–±–µ
        colony.Position.Z + Random.Range(-30, 30)
    );
    
    var transportId = await _spawner.SpawnStructureAsync(
        "GLEX_DropShip_T1",
        spawnPosition,
        Vector3.Zero,
        colony.FactionId
    );
    
    var travelTime = CalculateTravelTime(spawnPosition, destination);
    
    var mission = new TransportMission
    {
        MissionId = Guid.NewGuid().ToString(),
        ColonyId = colony.Id,
        TransportEntityId = transportId,
        TransportType = TransportType.DropShip,
        StartPosition = spawnPosition,
        Destination = destination,
        CurrentPhase = MissionPhase.EnRoute,
        CargoCount = defenderCount,
        StartTime = DateTime.UtcNow,
        EstimatedArrival = DateTime.UtcNow.AddSeconds(travelTime),
        IsDirectSpawn = false
    };
    
    _activeMissions[mission.MissionId] = mission;
    
    _logger.LogInformation(
        $"Transport mission {mission.MissionId}: DropShip dispatched with {defenderCount} guards, ETA: {travelTime:F0}s"
    );
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
    await InitiateTransportMovementAsync(mission);
    
    return mission;
}
```

### 4.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏–π

```csharp
/// <summary>
/// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –º–∏—Å—Å–∏–π
/// </summary>
public void UpdateTransportMissions(float deltaTime)
{
    foreach (var mission in _activeMissions.Values.ToList())
    {
        UpdateMissionAsync(mission, deltaTime).Wait();
    }
}

/// <summary>
/// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∏—Å—Å–∏–∏
/// </summary>
private async Task UpdateMissionAsync(TransportMission mission, float deltaTime)
{
    if (mission.CurrentPhase == MissionPhase.Completed)
        return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    if (!await _spawner.EntityExistsAsync(mission.TransportEntityId))
    {
        _logger.LogWarning($"Mission {mission.MissionId}: Transport destroyed!");
        _activeMissions.TryRemove(mission.MissionId, out _);
        return;
    }
    
    var transportEntity = _playfield.Entities[mission.TransportEntityId];
    
    switch (mission.CurrentPhase)
    {
        case MissionPhase.EnRoute:
            var distanceToTarget = Vector3.Distance(transportEntity.Pos, mission.Destination);
            if (distanceToTarget < 80f)  // –ü—Ä–∏–±—ã–ª–∏ –≤ –∑–æ–Ω—É –≤—ã—Å–∞–¥–∫–∏
            {
                mission.CurrentPhase = MissionPhase.Deploying;
                await DeployCargoAsync(mission);
            }
            break;
        
        case MissionPhase.Deploying:
            // –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ –≤—ã—Å–∞–¥–∫–∏
            if ((DateTime.UtcNow - mission.StartTime).TotalSeconds > 5)
            {
                mission.CurrentPhase = MissionPhase.Returning;
                await InitiateReturnAsync(mission);
            }
            break;
        
        case MissionPhase.Returning:
            var distanceToBase = Vector3.Distance(transportEntity.Pos, mission.StartPosition);
            if (distanceToBase < 100f)
            {
                await CompleteMissionAsync(mission);
            }
            break;
    }
}

/// <summary>
/// –í—ã—Å–∞–¥–∫–∞ –≥—Ä—É–∑–∞ –∏–∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
/// </summary>
private async Task DeployCargoAsync(TransportMission mission)
{
    var colony = _state.Colonies.First(c => c.Id == mission.ColonyId);
    var transportEntity = _playfield.Entities[mission.TransportEntityId];
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    _aimOrchestrator.StopNPC(transportEntity);
    
    // –í—ã—Å–∞–¥–∫–∞ —é–Ω–∏—Ç–æ–≤ –ø–æ–¥ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º
    var deployPosition = new Vector3(
        mission.Destination.X,
        mission.Destination.Y - 40f,
        mission.Destination.Z
    );
    
    var guardIds = await _spawner.SpawnNPCGroupAsync(
        "ZiraxMinigunPatrol",
        deployPosition,
        mission.CargoCount,
        colony.FactionId
    );
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —é–Ω–∏—Ç—ã
    foreach (var entityId in guardIds)
    {
        _unitEconomy.RegisterActiveUnit(colony, entityId, UnitType.Guard, "AirDrop");
        mission.DeployedUnitIds.Add(entityId);
    }
    
    _logger.LogInformation(
        $"Mission {mission.MissionId}: Deployed {guardIds.Count} guards at {mission.Destination}"
    );
}

/// <summary>
/// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏—Å—Å–∏–∏
/// </summary>
private async Task CompleteMissionAsync(TransportMission mission)
{
    await _spawner.DestroyEntityAsync(mission.TransportEntityId);
    mission.CurrentPhase = MissionPhase.Completed;
    _activeMissions.TryRemove(mission.MissionId, out _);
    
    _logger.LogInformation($"Mission {mission.MissionId}: Completed successfully");
}
```

---

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Threat Director

```csharp
// –í ThreatDirector.SpawnDefendersAsync()
public async Task SpawnDefendersAsync(Colony colony, Vector3 incidentLocation, int count)
{
    // –°–¢–ê–†–´–ô –ö–û–î (–ø—Ä—è–º–æ–π —Å–ø–∞–≤–Ω):
    // var guardIds = await _spawner.SpawnNPCGroupAsync(...);
    
    // –ù–û–í–´–ô –ö–û–î (—á–µ—Ä–µ–∑ Transport Manager):
    var mission = await _transportManager.DeployDefendersAsync(
        colony,
        incidentLocation,
        count
    );
    
    if (mission != null && !mission.IsDirectSpawn)
    {
        _logger.LogInformation(
            $"Reinforcements dispatched via {mission.TransportType}, " +
            $"ETA: {mission.EstimatedArrival?.ToString("HH:mm:ss")}"
        );
    }
    else if (mission != null && mission.IsDirectSpawn)
    {
        _logger.LogInformation($"Defenders deployed directly (base defense)");
    }
}
```

---

## 6. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
{
  "Transport": {
    "Enabled": true,
    "UseForOutpostDefense": true,
    "UseForPatrols": true,
    "UseForLogistics": false,
    "DropShipSpeed": 45.0,
    "DeploymentAltitude": 40.0,
    "BaseDefenseRadius": 200.0,
    "RadioMessages": {
      "ReinforcementsDispatched": "[Zirax Base] Reinforcements en route.",
      "ReinforcementsArrived": "[Zirax Base] Reinforcements deployed."
    }
  }
}
```

---

## 7. –ò–≥—Ä–æ–≤–æ–π –æ–ø—ã—Ç

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è Transport Manager:
- ‚ùå –ê—Ç–∞–∫—É—é –∞–≤–∞–Ω–ø–æ—Å—Ç ‚Üí –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- ‚ùå –ù–µ—Ç –æ—â—É—â–µ–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –±–∞–∑–æ–π –∏ –∞–≤–∞–Ω–ø–æ—Å—Ç–∞–º–∏

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è Transport Manager:
- ‚úÖ –ê—Ç–∞–∫—É—é –∞–≤–∞–Ω–ø–æ—Å—Ç ‚Üí –≤–∏–∂—É –¥–µ—Å–∞–Ω—Ç–Ω—ã–π –∫–æ—Ä–∞–±–ª—å, –ª–µ—Ç—è—â–∏–π –æ—Ç –±–∞–∑—ã
- ‚úÖ –ú–æ–≥—É –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç ‚Üí —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞
- ‚úÖ –ë–∞–∑–∞ —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è –∫–∞–∫ —Ü–µ–Ω—Ç—Ä –≤–æ–µ–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –ê—Ç–∞–∫–∞ –Ω–∞ —Å–∞–º—É –±–∞–∑—É ‚Üí –∑–∞—â–∏—Ç–Ω–∏–∫–∏ –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –ø–æ—Ä—Ç–∞–ª–∞/–∞–Ω–≥–∞—Ä–∞ (–ª–æ–≥–∏—á–Ω–æ)

---

## 8. –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

**–≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 –¥–µ–Ω—å)**
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ITransportManager`
- [ ] –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (`TransportMission`, enums)
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–≠—Ç–∞–ø 2: –£–º–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (2 –¥–Ω—è)**
- [ ] `DeployDefendersAsync()` —Å –∞–≤—Ç–æ–≤—ã–±–æ—Ä–æ–º –º–µ—Ç–æ–¥–∞
- [ ] `DeployFromBaseOrPortalAsync()` - –ø—Ä—è–º–æ–π —Å–ø–∞–≤–Ω
- [ ] `DeployViaTransportAsync()` - —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç

**–≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏–π (1 –¥–µ–Ω—å)**
- [ ] `UpdateTransportMissions()`
- [ ] State machine –¥–ª—è —Ñ–∞–∑ –º–∏—Å—Å–∏–∏
- [ ] `DeployCargoAsync()`, `CompleteMissionAsync()`

**–≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1 –¥–µ–Ω—å)**
- [ ] Threat Director ‚Üí Transport Manager
- [ ] Core Loop ‚Üí `UpdateTransportMissions()`
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ò—Ç–æ–≥–æ:** ~5 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## 9. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–î–≤–∏–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä—è–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ IEntity API. –ù–µ—Ç –æ–±—Ö–æ–¥–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π.
2. **–ú–µ–∂—Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–ª–µ—Ç—ã:** –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (—Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ).
3. **–í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:** –ù–µ—Ç –ø–∞—Ä—Ç–∏–∫–ª–æ–≤ –ø—Ä–∏ –≤—ã—Å–∞–¥–∫–µ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ModAPI).

---

## 10. –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

- **[Module_10_Threat_Director.md](Module_10_Threat_Director.md)** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å Transport Manager
- **[Module_04_Entity_Spawner.md](Module_04_Entity_Spawner.md)** ‚Äî —Å–ø–∞–≤–Ω —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ —é–Ω–∏—Ç–æ–≤
- **[Module_13_Unit_Economy.md](Module_13_Unit_Economy.md)** ‚Äî —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —é–Ω–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π
- **[Module_07_Colony_Evolution.md](Module_07_Colony_Evolution.md)** ‚Äî –ø–æ—Ä—Ç–∞–ª—ã –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 29.01.2026  
**–†–∞–∑–º–µ—Ä:** ~470 —Å—Ç—Ä–æ–∫
