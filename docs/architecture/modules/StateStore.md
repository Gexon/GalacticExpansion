# Модуль `StateStore`

**Ответственность**: хранение состояния симуляции на диске (`state.json`), загрузка/валидация/миграции/атомарная запись.  
**Аудитория**: разработчики.  
**Статус**: draft.  
**Связанные документы**: [`../04_data_model.md`](../04_data_model.md), [`../../config/state_schema.md`](../../config/state_schema.md).  

## Входы

- Команды “сохранить state” (например, после изменения стадии).
- Запрос “прочитать/инициализировать state” на старте.
- Версии схемы (миграции).

## Выходы

- Файл `state.json` в каталоге данных мода.
- Логи миграций и проблем чтения/валидации.

## Инварианты

- Запись атомарная: `state.json.tmp` → rename в `state.json`.
- Любое изменение схемы сопровождается миграцией и увеличением `schemaVersion`.
- При ошибке чтения/валидации мод не должен “молчать”: нужен понятный лог и безопасный режим (например, “не выполняем опасных действий, пока state не починен”).

## Edge cases

- “битый JSON” после аварии: должен быть механизм восстановления (бэкап/копия).
- Старая версия схемы: автоматическая миграция.